name = "llm-chat-proxy"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

[[rules]]
type = "Text"
globs = ["**/*.javascript", "**/*.py", "**/*.jiki"]
fallthrough = true

[[routes]]
pattern = "chat.jiki.io"
custom_domain = true

# Rate limiting: 100 requests per hour
# TODO: Create rate limiter namespace in Cloudflare and uncomment
# [[unsafe.bindings]]
# name = "RATE_LIMITER"
# type = "ratelimit"
# namespace_id = "llm_chat_rate_limit"
# simple = { limit = 100, period = 3600 }

# Environment variables are set via: wrangler secret put <NAME>
# Required secrets:
# - GOOGLE_GEMINI_API_KEY       (Get from: https://aistudio.google.com/apikey)
# - DEVISE_JWT_SECRET_KEY       (MUST match Rails exactly - from Rails credentials)
# - LLM_SIGNATURE_SECRET        (Shared with Rails for HMAC verification - from Rails credentials)
#
# For local development, create .dev.vars with these values
