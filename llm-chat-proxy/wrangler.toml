name = "llm-chat-proxy"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

[[rules]]
type = "Text"
globs = ["**/*.javascript", "**/*.py", "**/*.jiki"]
fallthrough = true

# Rate limiting for development: 100 requests per minute
# Note: Local dev only supports period of 10 or 60 seconds
[[unsafe.bindings]]
name = "RATE_LIMITER"
type = "ratelimit"
namespace_id = "llm_chat_rate_limit"
simple = { limit = 100, period = 60 }

[env.production]
name = "llm-chat-proxy"
workers_dev = false
route = "https://llm.jiki.app/*"

# Rate limiting for production: 100 requests per hour
[[env.production.unsafe.bindings]]
name = "RATE_LIMITER"
type = "ratelimit"
namespace_id = "llm_chat_rate_limit"
simple = { limit = 100, period = 3600 }

# Environment variables are set via: wrangler secret put <NAME>
# Required secrets:
# - GOOGLE_GEMINI_API_KEY       (Get from: https://aistudio.google.com/apikey)
# - DEVISE_JWT_SECRET_KEY       (MUST match Rails exactly - from Rails credentials)
# - LLM_SIGNATURE_SECRET        (Shared with Rails for HMAC verification - from Rails credentials)
#
# For local development, create .dev.vars with these values
